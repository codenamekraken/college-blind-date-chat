<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blind Date Chat</title>

<style>
body {
  background:#0f172a;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  color:white;
}

.chat-box {
  background:#020617;
  width:360px;
  padding:16px;
  border-radius:12px;
}

.messages {
  height:220px;
  border:1px solid #1e293b;
  margin:10px 0;
  padding:8px;
  overflow-y:auto;
  display:none;
}

.msg {
  margin-bottom:6px;
}

input,button {
  width:100%;
  padding:10px;
  border:none;
  margin-bottom:6px;
}

button {
  background:#f43f5e;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="chat-box">
  <h3>ðŸ’¬ Blind Date Chat</h3>

  <input id="matchId" placeholder="BD-123456">
  <button onclick="verify()">Enter Chat</button>

  <div id="chat" class="messages"></div>

  <input id="msg" placeholder="Message">
  <button onclick="sendMsg()">Send</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxrOZAtc0a_ont2T-EShETVAupRGCU3JEiWDWBUQOkuxKOGvYg0Yt0fEByfaZhWgkA4/exec";
let matchId = "";

function verify() {
  matchId = document.getElementById("matchId").value.trim();

  fetch(`${API_URL}?matchId=${matchId}`)
    .then(r => r.text())
    .then(res => {
      if (res === "VALID") {
        document.getElementById("chat").style.display = "block";
        loadMessages();
        setInterval(loadMessages, 2000);
      } else {
        alert("Invalid MatchID");
      }
    });
}

function sendMsg() {
  const msg = document.getElementById("msg").value.trim();
  if (!msg) return;

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      matchId: matchId,
      sender: "Anonymous",
      message: msg
    })
  });

  document.getElementById("msg").value = "";
}

function loadMessages() {
  fetch(`${API_URL}?matchId=${matchId}&mode=fetch`)
    .then(r => r.json())
    .then(data => {
      const chat = document.getElementById("chat");
      chat.innerHTML = "";
      data.forEach(m => {
        const div = document.createElement("div");
        div.className = "msg";
        div.textContent = `${m.sender}: ${m.message}`;
        chat.appendChild(div);
      });
      chat.scrollTop = chat.scrollHeight;
    });
}
</script>

</body>
</html>
