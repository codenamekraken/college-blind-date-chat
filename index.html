<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blind Date Chat</title>
    <style>
        /* Color Palette from Screenshots */
        :root { 
            --primary: #f43f5e; 
            --bg-dark: #0f172a; 
            --card-bg: #1e293b; 
            --input-bg: #020617;
            --text-main: #f1f5f9; 
            --text-dim: #94a3b8;
        }

        body { 
            background: var(--bg-dark); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            color: var(--text-main); 
        }

        /* Responsive Container matching image_409e8a.png */
        .app-container { 
            background: var(--card-bg); 
            width: 100%; 
            max-width: 450px; 
            height: 90vh; 
            display: flex; 
            flex-direction: column; 
            border-radius: 28px; 
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.7); 
            overflow: hidden; 
            margin: 10px; 
            border: 1px solid #334155; 
        }

        /* Header matching image_402367.png */
        .header { 
            background: transparent; 
            padding: 25px 20px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
            text-align: center;
        }

        .header h2 { 
            margin: 0; 
            font-size: 1.3rem; 
            color: var(--primary); 
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Login Screen matching image_409e8a.png */
        #login-screen { 
            padding: 60px 40px; 
            text-align: center; 
            margin-top: auto; 
            margin-bottom: auto; 
        }

        #login-screen h1 { 
            font-size: 2rem; 
            font-weight: 800;
            margin-bottom: 15px; 
            color: #ffffff;
        }

        #login-screen p { 
            color: var(--text-dim); 
            font-size: 1rem; 
            margin-bottom: 35px; 
            line-height: 1.5;
        }

        /* Chat Screen Styles */
        #chat-screen { 
            display: none; 
            flex-direction: column; 
            flex: 1; 
        }

        .messages { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            background: var(--input-bg); 
            margin: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .msg { 
            padding: 12px 18px; 
            border-radius: 18px; 
            font-size: 0.95rem; 
            max-width: 85%; 
            line-height: 1.5; 
            background: #334155; 
            position: relative; 
            align-self: flex-start;
        }

        .msg.me {
            align-self: flex-end;
            background: var(--primary);
            color: white;
        }

        .msg b { 
            display: block; 
            font-size: 11px; 
            text-transform: uppercase; 
            margin-bottom: 6px; 
            opacity: 0.8;
            letter-spacing: 0.8px; 
        }

        /* Admin UI */
        .join-btn { 
            font-size: 10px; 
            background: rgba(255,255,255,0.2); 
            padding: 5px 10px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin-bottom: 5px;
            display: inline-block;
        }

        /* Input Area matching image_402367.png */
        .input-area { 
            padding: 20px; 
            background: transparent; 
            display: flex; 
            flex-direction: column;
            gap: 15px; 
        }

        .input-wrapper {
            position: relative;
        }

        input { 
            width: 100%; 
            padding: 16px 20px; 
            border-radius: 12px; 
            border: 1px solid #334155; 
            background: #020617; 
            color: white; 
            outline: none; 
            box-sizing: border-box;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        input:focus { border-color: var(--primary); }

        button { 
            width: 100%;
            padding: 16px; 
            background: var(--primary); 
            border: none; 
            border-radius: 12px; 
            color: white; 
            font-weight: 800; 
            font-size: 1.1rem;
            cursor: pointer; 
            transition: transform 0.2s, background 0.2s;
        }

        button:active { transform: scale(0.98); background: #e11d48; }

        #admin-info { 
            padding: 10px; 
            background: rgba(244, 63, 94, 0.1); 
            font-size: 12px; 
            text-align: center; 
            border-bottom: 1px solid rgba(244, 63, 94, 0.2); 
        }

        .report-btn { font-size: 10px; color: var(--text-dim); cursor: pointer; margin-top: 8px; text-decoration: underline; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2 id="title">ðŸ’¬ Blind Date Chat</h2>
    </div>

    <div id="login-screen">
        <h1>Welcome</h1>
        <p>Enter your Match ID to join your private chat.</p>
        <input id="mid" placeholder="BD-XXXXXX" maxlength="9">
        <button onclick="start()">Join Chat</button>
    </div>

    <div id="chat-screen">
        <div id="admin-info" style="display:none;">
            Viewing: <span id="current-room" style="font-weight: bold;">All Rooms</span>
        </div>
        <div id="msgs" class="messages"></div>
        <div class="input-area">
            <input id="txt" placeholder="Type a message...">
            <button onclick="send()">Send</button>
        </div>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxVOq0RjUc8rLr2Kf3UoHQ0WYxUNr0l1B_k4N06e6sSeO0S10wQCWkGVlvJo4NIhZb9/exec";
    const ADMIN_PASS = "adityasingh710";
    
    let mid = "";
    let gender = "";
    let isAdmin = false;

    function start() {
        mid = document.getElementById("mid").value.trim().toUpperCase();
        if(!mid) return;

        if(mid === ADMIN_PASS.toUpperCase()) {
            isAdmin = true; gender = "ADMIN";
            showChat("ðŸ› ï¸ Admin Dashboard");
            setInterval(loadAdmin, 3000); loadAdmin();
            return;
        }

        fetch(`${API_URL}?matchId=${mid}`).then(r => r.text()).then(res => {
            if(res !== "INVALID") {
                gender = res;
                showChat(`Chatting as ${res}`);
                setInterval(loadChat, 3000); loadChat();
            } else { alert("ID not found."); }
        });
    }

    function showChat(title) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("chat-screen").style.display = "flex";
        document.getElementById("title").innerText = title;
        if(isAdmin) document.getElementById("admin-info").style.display = "block";
    }

    function send(isReport = false, reportMsg = "") {
        const input = document.getElementById("txt");
        const msg = isReport ? reportMsg : input.value.trim();
        if(!msg) return;

        fetch(API_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify({ matchId: mid, sender: gender, message: msg, isReport: isReport })
        }).then(() => { 
            if(!isReport) input.value = ""; 
            isAdmin ? loadAdmin() : loadChat();
        });
    }

    function report() {
        const reason = prompt("Why are you reporting this user?");
        if(reason) send(true, "USER REPORTED: " + reason);
    }

    function join(id) { mid = id; document.getElementById("current-room").innerText = id; }

    function loadChat() {
        fetch(`${API_URL}?matchId=${mid}&mode=fetch`).then(r => r.json()).then(data => {
            const box = document.getElementById("msgs");
            box.innerHTML = data.map(m => `
                <div class="msg ${m.sender === gender ? 'me' : ''}">
                    <b>${m.sender}</b>
                    <span>${m.message}</span>
                    ${m.sender !== gender ? `<br><span class="report-btn" onclick="report()">Report Issue</span>` : ''}
                </div>
            `).join("");
            box.scrollTop = box.scrollHeight;
        });
    }

    function loadAdmin() {
        fetch(`${API_URL}?mode=adminFetch`).then(r => r.json()).then(data => {
            const box = document.getElementById("msgs");
            box.innerHTML = data.map(m => `
                <div class="msg">
                    <span class="join-btn" onclick="join('${m.room}')">Join Room: ${m.room}</span>
                    <b>${m.sender}</b>
                    <span>${m.message}</span>
                </div>
            `).join("");
            box.scrollTop = box.scrollHeight;
        });
    }

    // Support for Enter Key
    document.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            const login = document.getElementById("login-screen");
            if (login.style.display !== "none") {
                start();
            } else {
                send();
            }
        }
    });
</script>
</body>
</html>
