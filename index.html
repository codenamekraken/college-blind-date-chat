<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>College Blind Date Chat</title>

<style>
body {
  background:#0f172a;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.chat-box {
  background:#020617;
  width:360px;
  padding:16px;
  border-radius:12px;
  color:white;
}
.messages {
  height:220px;
  border:1px solid #1e293b;
  margin:10px 0;
  padding:8px;
  overflow-y:auto;
  display:none;
}
input,button {
  width:100%;
  padding:10px;
  border:none;
  margin-bottom:6px;
}
button {
  background:#f43f5e;
  color:white;
}
.msg {
  margin-bottom:6px;
}
</style>
</head>

<body>
<div class="chat-box">
  <h3>ðŸ’¬ Blind Date Chat</h3>

  <input id="matchId" placeholder="BD-123456">
  <button onclick="enterChat()">Enter Chat</button>

  <div id="chat" class="messages"></div>

  <input id="msg" placeholder="Type message">
  <button onclick="sendMsg()">Send</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxrOZAtc0a_ont2T-EShETVAupRGCU3JEiWDWBUQOkuxKOGvYg0Yt0fEByfaZhWgkA4/exec";
let matchId = "";
let lastCount = 0;

function enterChat() {
  matchId = document.getElementById("matchId").value.trim();
  fetch(`${API}?matchId=${matchId}`)
    .then(r => r.text())
    .then(res => {
      if (res === "VALID") {
        document.getElementById("chat").style.display = "block";
        setInterval(loadMessages, 2000);
      } else {
        alert("Invalid Match ID");
      }
    });
}

function sendMsg() {
  const msg = document.getElementById("msg").value.trim();
  if (!msg) return;

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      matchId: matchId,
      sender: "Anonymous",
      message: msg
    })
  });

  document.getElementById("msg").value = "";
}

function loadMessages() {
  fetch(`${API}?matchId=${matchId}&mode=fetch`)
    .then(r => r.json())
    .then(data => {
      if (data.length === lastCount) return;
      lastCount = data.length;

      const chat = document.getElementById("chat");
      chat.innerHTML = "";
      data.forEach(m => {
        const d = document.createElement("div");
        d.className = "msg";
        d.textContent = `${m.sender}: ${m.message}`;
        chat.appendChild(d);
      });
      chat.scrollTop = chat.scrollHeight;
    });
}
</script>
</body>
</html>
